<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BOT GA CON V3</title>

<style>
body{
  background:#000;
  color:#00ff66;
  font-family:monospace;
}
.app{
  max-width:420px;
  margin:auto;
  padding:15px;
  border:2px solid #00ff66;
  text-align:center;
}
input,select,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  background:#000;
  border:1px solid #00ff66;
  color:#00ff66;
}
button.sub{border-color:#00aaff;color:#00aaff}
button.danger{border-color:#ff4444;color:#ff4444}
.bet{
  margin:12px 0;
  padding:10px;
  border:2px dashed #00ff66;
  font-size:18px;
}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:8px;
  margin:10px 0;
}
.gate{
  padding:14px;
  border:1px solid #00ff66;
  cursor:pointer;
}
.gate.sel{background:#003300}
canvas{
  border:1px solid #00ff66;
  margin-top:10px;
}
pre{
  text-align:left;
  font-size:13px;
}
.stats{
  border:1px dashed #00ff66;
  padding:8px;
  margin:10px 0;
  font-size:14px;
}
</style>
</head>

<body>
<div class="app">

<div id="loginBox">
  <h2>ğŸ¤– BOT GA CON V3</h2>
  <input id="user" placeholder="TÃ i khoáº£n">
  <input id="pass" type="password" placeholder="Máº­t kháº©u">
  <button onclick="login()">ÄÄƒng nháº­p</button>
  <button class="sub" onclick="showRegister()">+ Táº¡o tÃ i khoáº£n</button>
</div>

<div id="registerBox" style="display:none">
  <h2>ğŸ†• Táº¡o tÃ i khoáº£n</h2>
  <input id="regUser" placeholder="TÃ i khoáº£n">
  <input id="regPass" type="password" placeholder="Máº­t kháº©u">
  <button onclick="register()">Táº¡o</button>
  <button class="sub" onclick="showLogin()">â† Quay láº¡i</button>
</div>

<div id="botBox" style="display:none">
  <h2 id="botPick">BOT CHá»ŒN: ...</h2>
  <h3 id="botPick2"></h3>

  <h1 id="betSuggest" class="bet">â³ Chá» dá»¯ liá»‡u</h1>

  <div class="stats" id="stats"></div>

  <select id="killerType">
    <option value="1">ğŸ” GÃ  (giáº¿t 1 phÃ²ng)</option>
    <option value="2">ğŸ Cáº·p ráº¯n (giáº¿t 2 phÃ²ng)</option>
    <option value="4">âš¡ Tháº§n sáº¥m (giáº¿t 4 phÃ²ng)</option>
  </select>

  <div id="gates" class="grid"></div>

  <button onclick="saveRound()">LÆ°u vÃ²ng</button>
  <button class="danger" onclick="resetHistory()">Reset</button>
  <button class="sub" onclick="logout()">ÄÄƒng xuáº¥t</button>

  <canvas id="chart" width="360" height="180"></canvas>
  <pre id="danger"></pre>
</div>

</div>

<script>
const loginBox = document.getElementById("loginBox");
const registerBox = document.getElementById("registerBox");
const botBox = document.getElementById("botBox");
const gates = document.getElementById("gates");
const botPick = document.getElementById("botPick");
const botPick2 = document.getElementById("botPick2");
const betSuggest = document.getElementById("betSuggest");
const danger = document.getElementById("danger");
const chart = document.getElementById("chart");
const statsBox = document.getElementById("stats");

const getAcc=()=>JSON.parse(localStorage.getItem("acc")||"{}");
const saveAcc=a=>localStorage.setItem("acc",JSON.stringify(a));

function login(){
  let a=getAcc();
  if(a[user.value]===pass.value){
    loginBox.style.display="none";
    registerBox.style.display="none";
    botBox.style.display="block";
    drawButtons();
    analyze();
  }else alert("Sai tÃ i khoáº£n");
}
function register(){
  let a=getAcc();
  if(a[regUser.value]) return alert("TÃ i khoáº£n tá»“n táº¡i");
  a[regUser.value]=regPass.value;
  saveAcc(a);
  alert("Táº¡o tÃ i khoáº£n thÃ nh cÃ´ng");
  showLogin();
}
function logout(){
  selected=[];
  botBox.style.display="none";
  loginBox.style.display="block";
}
function showRegister(){
  loginBox.style.display="none";
  registerBox.style.display="block";
}
function showLogin(){
  registerBox.style.display="none";
  loginBox.style.display="block";
}

const rooms=["ANTOÃ€N","MAY Máº®N","Tá»¬ THáº¦N","BÃ áº¨N","Máº O HIá»‚M"];
let selected=[];
let currentBotPick=null;

const getHistory=()=>JSON.parse(localStorage.getItem("his")||"[]");
const saveHistory=h=>localStorage.setItem("his",JSON.stringify(h));

function drawButtons(){
  gates.innerHTML="";
  rooms.forEach(r=>{
    let d=document.createElement("div");
    d.className="gate";
    d.innerText=r;
    d.onclick=()=>{
      d.classList.toggle("sel");
      selected.includes(r)
        ? selected=selected.filter(x=>x!==r)
        : selected.push(r);
    };
    gates.appendChild(d);
  });
}

function saveRound(){
  let type=+killerType.value;
  if(selected.length!==type) return alert("Chá»n Ä‘Ãºng "+type+" phÃ²ng");
  let h=getHistory();
  h.push({ dead:[...selected], bot: currentBotPick });
  if(h.length>50) h.shift();
  saveHistory(h);
  selected=[];
  drawButtons();
  analyze();
}

function resetHistory(){
  localStorage.removeItem("his");
  analyze();
}

function analyze(){
  let h=getHistory();
  let score={};
  rooms.forEach(r=>score[r]=1);

  let win=0, lose=0;

  h.slice(3).forEach(v=>{
    if(!v.bot) return;
    v.dead.includes(v.bot) ? lose++ : win++;
  });

  statsBox.innerHTML=
    `ğŸ“Š Tá»•ng vÃ¡n: ${win+lose}<br>
     âœ… Win: ${win}<br>
     âŒ Lose: ${lose}`;

  if(h.length<3){
    botPick.innerText="BOT CHá»ŒN: â³ Chá» Ä‘á»§ 3 vÃ¡n";
    betSuggest.innerText="â³ CHÆ¯A NÃŠN CÆ¯á»¢C";
    drawChart(score,5);
    return;
  }

  let recent=h.slice(-7);
  rooms.forEach(r=>{
    let dead=0;
    recent.forEach(v=>{ if(v.dead.includes(r)) dead++; });
    let winR=recent.length-dead;
    score[r]-=dead*1.2;
    score[r]+=winR*1.5;
    if(score[r]<0.5) score[r]=0.5;
  });

  let sorted=[...rooms].sort((a,b)=>score[a]-score[b]);
  currentBotPick=sorted[0];
  let sub=sorted[1];

  let max=Math.max(...Object.values(score));
  let p1=((1-score[currentBotPick]/max)*100).toFixed(0);
  let p2=((1-score[sub]/max)*100).toFixed(0);

  botPick.innerText=`BOT CHá»ŒN: ${currentBotPick} (${p1}%)`;
  botPick2.innerText=`BOT PHá»¤: ${sub} (${p2}%)`;

  betSuggest.innerText=
    p1>65?"ğŸ”´ CÆ¯á»¢C Máº NH":
    p1>45?"ğŸŸ¡ CÆ¯á»¢C Vá»ªA":
           "ğŸŸ¢ CÆ¯á»¢C NHáº¸";

  danger.innerText=rooms.map(r=>
    `${r}: ${((score[r]/max)*100).toFixed(1)}% nguy hiá»ƒm`
  ).join("\n");

  drawChart(score,max);
}

function drawChart(score,max){
  let ctx=chart.getContext("2d");
  ctx.clearRect(0,0,chart.width,chart.height);
  rooms.forEach((r,i)=>{
    let h=(score[r]/max)*(chart.height-30);
    ctx.fillStyle=i<2?"#ffaa00":"#00ff66";
    ctx.fillRect(10+i*70,chart.height-h-20,50,h);
    ctx.fillText(r[0],30+i*70,chart.height-5);
  });
}
</script>
</body>
</html>